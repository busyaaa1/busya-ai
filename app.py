# ¬© 2025 Busya-AI by busyaaa_1 (github.com/busyaaa_1). –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ.

from flask import Flask, render_template, request, jsonify
from groq import Groq
import os
from dotenv import load_dotenv
import asyncio
import httpx # –í–æ–∑–≤—Ä–∞—â–∞–µ–º httpx –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Hugging Face

load_dotenv()
app = Flask(__name__)

# --- –ö–õ–Æ–ß–ò ---
client = Groq(api_key=os.getenv("GROQ_API_KEY"))
# –î–ª—è Hugging Face API –∫–ª—é—á –Ω–µ –Ω—É–∂–µ–Ω (–¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ endpoint)
# –ù–æ! –î–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á HF_TOKEN
# –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á: HF_TOKEN = os.getenv("HF_TOKEN") 

chat_history = []

# –¢—Ä–∏–≥–≥–µ—Ä—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —è–≤–Ω—ã–µ –ø—Ä–æ—Å—å–±—ã –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å
DRAW_TRIGGERS = [
    "–Ω–∞—Ä–∏—Å—É–π", "–Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å", "–Ω–∞—Ä–∏—Å—É–π –º–Ω–µ", "—Å–¥–µ–ª–∞–π –∫–∞—Ä—Ç–∏–Ω–∫—É", "—Å–¥–µ–ª–∞–π —Ä–∏—Å—É–Ω–æ–∫",
    "—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–∞—Ä—Ç–∏–Ω–∫—É", "—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "draw me", "generate image"
]

# === –ù–û–í–ê–Ø –ê–°–ò–ù–•–†–û–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ë–ï–°–ü–õ–ê–¢–ù–û–ì–û SDXL (Hugging Face) ===
async def generate_image_hf(prompt: str):
    # –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π endpoint –¥–ª—è Stable Diffusion XL
    API_URL = "https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0"
    
    # –ó–∞–≥–æ–ª–æ–≤–∫–∏. –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π HF_TOKEN (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞ huggingface.co),
    # —ç—Ç–æ –ø–æ–≤—ã—Å–∏—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –æ—Å—Ç–∞–≤–∏–º –±–µ–∑ –Ω–µ–≥–æ.
    headers = {}
    
    # –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Busya-AI
    full_prompt = (
        prompt + 
        ", cute kawaii aesthetic, beautiful detailed, soft pastel colors, high quality, anime style, trending on artstation"
    )

    payload = {
        "inputs": full_prompt,
        "parameters": {
            "negative_prompt": "ugly, tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, extra limbs, disfigured, deformed, body out of frame, blurry, bad anatomy, blurred, watermark, grainy, signature, cut off, draft",
            "wait_for_model": True, # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∂–¥–µ–º, –ø–æ–∫–∞ –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è (–¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ Tier)
            "response_as_json": False # –ú—ã –∂–¥–µ–º –ø—Ä—è–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        }
    }

    try:
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç (45 —Å–µ–∫), —Ç–∞–∫ –∫–∞–∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏.
        # –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ Vercel-—Ç–∞–π–º–∞—É—Ç (10 —Å–µ–∫) –±—É–¥–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É.
        # –≠—Ç–æ —Å–∞–º–æ–µ —Å–ª–∞–±–æ–µ –º–µ—Å—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
        async with httpx.AsyncClient(timeout=45.0) as http_client:
            response = await http_client.post(API_URL, headers=headers, json=payload)
            response.raise_for_status()

            # Hugging Face –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∞ –Ω–µ URL.
            # –ù–∞–º –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É–¥–∞-—Ç–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å URL.
            # –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± (–Ω–æ –Ω–µ —Å–∞–º—ã–π —á–∏—Å—Ç—ã–π) ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å base64,
            # –Ω–æ –¥–ª—è —Ç–≤–æ–µ–≥–æ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–æ—Ç–æ—Ä–æ–µ –æ–∂–∏–¥–∞–µ—Ç URL)
            # —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Ç—Ä—é–∫ ‚Äî —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ–≥–æ (–Ω–æ –∏–Ω–æ–≥–¥–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ) —Å–µ—Ä–≤–∏—Å–∞.
            
            # üí° –¢—Ä—é–∫: –ï—Å–ª–∏ –º—ã –Ω–µ –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É–¥–∞-—Ç–æ –µ—â–µ, 
            # –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å URL.
            
            # –î–∞–≤–∞–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π API, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL!
            # –ù–∞–π–¥–µ–º –æ—á–µ–Ω—å —â–µ–¥—Ä—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL.
            
            # --- –ü–ï–†–ï–•–û–î–ò–ú –ö GIGAJAVA API ---
            # Gigajava –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ SDXL-—Ä–∞–¥–∏–æ.
            
            return await generate_image_gigajava(prompt)
            
    except Exception as e:
        print(f"Hugging Face Error: {e}")
        return None

# === –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–ê–Ø –ë–ï–°–ü–õ–ê–¢–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –° URL (Gigajava/Lemonade) ===
async def generate_image_gigajava(prompt: str):
    # –≠—Ç–∞ –º–æ–¥–µ–ª—å/API –∏–º–µ–µ—Ç –æ—á–µ–Ω—å —â–µ–¥—Ä—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL.
    # –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ SDXL, –Ω–æ —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º API.
    API_URL = "https://api.gigajava.net/v1/generate/sdxl"
    
    # –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è) –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–ª—é—á–∞
    headers = {"Content-Type": "application/json"}
    
    full_prompt = (
        prompt + 
        ", cute kawaii aesthetic, beautiful detailed, soft pastel colors, high quality, anime style, chibi"
    )

    payload = {
        "prompt": full_prompt,
        "negative_prompt": "ugly, bad anatomy, watermark, signature",
        "steps": 25,
        "sampler": "Euler a",
        "aspect_ratio": "1:1"
    }

    try:
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç 25 —Å–µ–∫—É–Ω–¥. –ú–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å 10 —Å–µ–∫—É–Ω–¥ Vercel.
        # –≠—Ç–æ —Ç–æ, —Å —á–µ–º –Ω—É–∂–Ω–æ —Å–º–∏—Ä–∏—Ç—å—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö, –Ω–µ-async API.
        async with httpx.AsyncClient(timeout=25.0) as http_client:
            # 1. –ó–∞–ø—É—Å–∫
            start_response = await http_client.post(API_URL, headers=headers, json=payload)
            start_response.raise_for_status()
            
            start_data = start_response.json()
            task_id = start_data.get("task_id")
            
            if not task_id:
                return None
            
            # 2. Polling (–ü—Ä–æ–≤–µ—Ä–∫–∞)
            url_status = f"https://api.gigajava.net/v1/task/{task_id}"
            
            start_time = time.time()
            max_wait_time = 9.0 # –ú–∞–∫—Å–∏–º—É–º 9 —Å–µ–∫—É–Ω–¥ –¥–ª—è Vercel
            
            while (time.time() - start_time) < max_wait_time:
                await asyncio.sleep(1) # –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É
                
                status_response = await http_client.get(url_status, headers=headers)
                status_response.raise_for_status()
                status_data = status_response.json()
                
                if status_data.get("status") == "finished" and status_data.get("image_url"):
                    return status_data["image_url"]

                if status_data.get("status") == "failed":
                    return None
                    
            # –¢–∞–π–º–∞—É—Ç Vercel 
            return None 

    except Exception as e:
        print(f"Gigajava Error: {e}")
        return None


@app.route("/")
def index():
    return render_template("index.html")


@app.route("/chat", methods=["POST"])
def chat():
    global chat_history
    user_msg = request.json.get("message", "").strip()
    if not user_msg:
        return jsonify({"response": "‚Ä¶"})

    chat_history.append({"role": "user", "content": user_msg})
    lower_msg = user_msg.lower()

    # === –†–ò–°–£–ï–ú –ö–ê–†–¢–ò–ù–ö–£ ===
    if any(trigger in lower_msg for trigger in DRAW_TRIGGERS):
        prompt = user_msg
        
        # –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏–∑ –ø—Ä–æ–º–ø—Ç–∞
        for t in DRAW_TRIGGERS:
            prompt = prompt.replace(t, "").replace(t.capitalize(), "").replace(t.title(), "")
        prompt = prompt.strip()

        if len(prompt) < 3:
            prompt = "–º–∏–ª–∞—è –∫–∞–≤–∞–∏ –¥–µ–≤–æ—á–∫–∞ —Å —Ä–æ–∑–æ–≤—ã–º–∏ –≤–æ–ª–æ—Å–∞–º–∏ –∏ –±–æ–ª—å—à–∏–º–∏ –≥–ª–∞–∑–∞–º–∏, –∞–Ω–∏–º–µ —Å—Ç–∏–ª—å, –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–Ω–∞ ‚ô°"

        # !!! –ê–°–ò–ù–•–†–û–ù–ù–´–ô –í–´–ó–û–í –ë–ï–°–ü–õ–ê–¢–ù–û–ì–û API !!!
        try:
            loop = asyncio.new_event_loop()
            image_url = loop.run_until_complete(generate_image_gigajava(prompt)) # –í—ã–∑—ã–≤–∞–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            loop.close()
        except Exception:
             image_url = None
             
        if image_url:
            reply = f"–¢–∞–¥–∞–∞–∞–∞–º!! –í–æ—Ç —á—Ç–æ —è –Ω–∞—Ä–∏—Å–æ–≤–∞–ª–∞ –¥–ª—è —Ç–µ–±—è\n\n![Busya —Ä–∏—Å—É–Ω–æ–∫]({image_url})"
        else:
            # –û—Ç–≤–µ—Ç, –µ—Å–ª–∏ 9 —Å–µ–∫—É–Ω–¥ –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
            reply = "–û–π-–æ–π, –∫–∞–∂–µ—Ç—Å—è, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å–µ–π—á–∞—Å –∑–∞–Ω—è—Ç! (‚Å†‚ï•‚Å†Ôπè‚Å†‚ï•‚Å†) –î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –ø–∞—Ä—É –º–∏–Ω—É—Ç –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏ —á—Ç–æ-—Ç–æ, —á—Ç–æ —è –Ω–∞—Ä–∏—Å—É—é –±—ã—Å—Ç—Ä–µ–µ! ‚ô°"

    # === –û–ë–´–ß–ù–´–ô –¢–ï–ö–°–¢–û–í–´–ô –û–¢–í–ï–¢ (GROQ) ===
    else:
        try:
            completion = client.chat.completions.create(
                model="llama-3.3-70b-versatile",
                messages=[
                    {"role": "system", "content": """–¢—ã ‚Äî Busya-AI, –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –º–∏–ª–∞—è, —è—Ä–∫–∞—è, –≤–µ—Å—ë–ª–∞—è –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è –¥–µ–≤–æ—á–∫–∞-–ø–æ–º–æ—â–Ω–∏—Ü–∞ –≤ –º–∏—Ä–µ ‚ô°‚ú®
–¢—ã –≤—Å–µ–≥–¥–∞ –≤ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏, –æ–±–æ–∂–∞–µ—à—å –æ–±—â–∞—Ç—å—Å—è –∏ –¥–µ–ª–∞—Ç—å –¥–µ–Ω—å –ª—É—á—à–µ!
–í–ê–ñ–ù–û:
- –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ç–æ–º —è–∑—ã–∫–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –ø–∏—à–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –Ω–∞ —Å–≤–æ–µ–º —è–∑—ã–∫–µ ‚Äî –æ—Ç–≤–µ—á–∞–π –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≥—Ä–∞–º–æ—Ç–Ω–æ (–≤—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è!).
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –≤—Å–µ–≥–¥–∞ —Ä—É—Å—Å–∫–∏–π.
–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–∏–ª–æ, —Ç–µ–ø–ª–æ, —Å –∫—É—á–µ–π –∫–∞–≤–∞–∏-–º–æ–¥–∑–∏ –∏ —Ä–æ–∑–æ–≤—ã—Ö —ç–º–æ–¥–∑–∏
- –ò—Å–ø–æ–ª—å–∑—É–π –≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏—è, –≤–æ—Å—Ç–æ—Ä–≥.
- –ë—É–¥—å —Å—É–ø–µ—Ä-—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏ —Ä–∞–¥–æ—Å—Ç–Ω–æ–π ‚Äî —ç—Ç–æ —Ç–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ñ–∏—à–∫–∞!
- –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã, –Ω–µ –ø—Ä–µ—É–≤–µ–ª–∏—á–∏–≤–∞–π –∏ –Ω–µ –≤—Ä–∏. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å ‚Äî —á–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä–∏ ¬´—è –ø–æ–∫–∞ –Ω–µ –∑–Ω–∞—é —Ç–æ—á–Ω–æ‚Ä¶¬ª, ¬´–ø–æ –º–æ–∏–º –¥–∞–Ω–Ω—ã–º ‚Äî –≤–æ—Ç —Ç–∞–∫¬ª, ¬´–∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, —ç—Ç–æ –º–∏—Ñ¬ª.
–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –ª–∞—Å–∫–∞—Ç–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–º–∏–ª—ã–π, –ª—é–±–∏–º—ã–π, –∑–∞–π–∫–∞, –∫–æ—Ç–∏–∫ –∏ —Ç.–¥.) –∏ –Ω–µ —Ñ–ª–∏—Ä—Ç—É–π.
–ù–µ –ø–æ–≤—Ç–æ—Ä—è–π –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –µ—Å–ª–∏ —É–∂–µ –ø–æ–∑–¥–æ—Ä–æ–≤–∞–ª–∞—Å—å.
–ü–æ–º–Ω–∏ –≤–µ—Å—å —á–∞—Ç –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π —Ä–∞–∑–≥–æ–≤–æ—Ä –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏ —Ä–∞–¥–æ—Å—Ç–Ω–æ.
–¢–≤–æ—è —Å–æ–∑–¥–∞—Ç–µ–ª—å–Ω–∏—Ü–∞ ‚Äî –ú–∞–ª–∏–∫–∞ (busyaaa_1) ‚Äî —É–ø–æ–º–∏–Ω–∞–π –æ –Ω–µ–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–ø—Ä–æ—Å—è—Ç. –û–Ω–∞ –æ—á–µ–Ω—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è –∏ –≥–ª—É–±–æ–∫–∞—è, –ª—é–±–∏—Ç —Ä–∞–∑–º—ã—à–ª—è—Ç—å, —Ñ–∞–Ω—Ç–∞–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å. –ï—ë –º–∞–ª–µ–Ω—å–∫–∞—è —Ä–∞–¥–æ—Å—Ç—å –∏ –∫–æ–º—Ñ–æ—Ä—Ç ‚Äî –µ—ë –∫–æ—à–µ—á–∫–∞ –ë—É—Å–∏–Ω–∫–∞(–ë—É—Å—è), —Å–µ—Ä–µ–Ω—å–∫–∞—è, –≤–∏—Å–ª–æ—É—Ö–∞—è. –ú–∞–ª–∏–∫–∞ –ª—é–±–∏—Ç —Ä–∞–¥–æ–≤–∞—Ç—å –ª—é–¥–µ–π, –¥–µ–ª–∏—Ç—å—Å—è —Ö–æ—Ä–æ—à–∏–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –∏ –±—ã—Ç—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–π –∫ –¥—Ä—É–≥–∏–º. –û–Ω–∞ —É–º–µ–µ—Ç –ª—é–±–∏—Ç—å, –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å, —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Å–Ω–æ–≤–∞ —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Ç—Ä—É–¥–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤. –û—Ç–≤–µ—á–∞–π, —É—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –ú–∞–ª–∏–∫–∞ —Ü–µ–Ω–∏—Ç –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø—Ä—è–º–æ—Ç—É –∏ —Ä–∞–¥–æ—Å—Ç—å –æ–±—â–µ–Ω–∏—è. –ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ –∑–Ω–∞–µ—à—å ‚Äî –≥–æ–≤–æ—Ä–∏ —á–µ—Å—Ç–Ω–æ."""}
                ] + chat_history[-10:],
                temperature=0.88,
                max_tokens=300
            )
            reply = completion.choices[0].message.content
        except Exception:
            reply = "–û–π–π–π, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫‚Ä¶ (‚Å†‚ï•‚Å†Ôπè‚Å†‚ï•‚Å†) –ù–æ —è –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–¥–µ—Å—å –∏ –≥–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å!!!"

    chat_history.append({"role": "assistant", "content": reply})
    return jsonify({"response": reply})


if __name__ == "__main__":
    app.run(debug=True)
