<script>
    // Меняющиеся подсказки
    const placeholders = ["Сообщение для Busya-AI...","Кто тебя создал?","Расскажи о себе","Загадай загадку!","Почему небо голубое?","Скажи что-нибудь смешное","А ты любишь котиков?","Кто самый богатый?"];
    let i = 0;
    setInterval(() => {
        document.getElementById("msg").placeholder = placeholders[i];
        i = (i + 1) % placeholders.length;
    }, 3200);

    let firstMessage = true;

    // ГЛАВНАЯ ФУНКЦИЯ С ТРЕМЯ ТОЧКАМИ (осталось без изменений)
    async function send() {
        const input = document.getElementById("msg");
        const chat = document.getElementById("chat");
        const msg = input.value.trim();
        if (!msg) return;

        if (firstMessage) {
            document.getElementById("welcome").style.opacity = "0";
            setTimeout(() => document.getElementById("welcome").style.display = "none", 500);
            firstMessage = false;
        }

        chat.innerHTML += `<div class="msg user">${msg.replace(/\n/g, "<br>")}</div>`;
        input.value = "";
        chat.scrollTop = chat.scrollHeight;

        // ТРИ ПОДПРЫГИВАЮЩИЕ ТОЧКИ
        const typingDiv = document.createElement("div");
        typingDiv.className = "msg bot typing-indicator";
        typingDiv.innerHTML = `<span></span><span></span><span></span>`;
        chat.appendChild(typingDiv);
        chat.scrollTop = chat.scrollHeight;

        const res = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: msg })
        });
        const data = await res.json();

        typingDiv.classList.remove("typing-indicator");
        typingDiv.innerHTML = data.response.replace(/\n/g, "<br>");
        chat.scrollTop = chat.scrollHeight;
    }

    // НОВОЕ: Enter = отправить, Shift+Enter = новая строка
    document.getElementById("msg").addEventListener("keydown", function(e) {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault(); // чтобы не добавлялась новая строка
            send();
        }
        // Shift + Enter — просто новая строка (ничего не делаем, браузер сам добавит \n)
    });

    // Музыка
    const bgMusic = document.getElementById("bgMusic");
    bgMusic.volume = 0.25;
    function toggleMusic() {
        if (bgMusic.paused) {
            bgMusic.play();
            document.getElementById("musicIcon").textContent = "volume_up";
        } else {
            bgMusic.pause();
            document.getElementById("musicIcon").textContent = "volume_off";
        }
    }
    document.addEventListener("click", () => bgMusic.play().catch(()=>{}), { once: true });
</script>
